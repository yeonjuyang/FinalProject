<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.workforest.schedule.mapper.ScheduleMapper">

	<!-- 내 일정 불러오기 -->
    <select id="getMySchedules" parameterType="String" resultType="scheduleVO">
    	SELECT 
				  SCHDUL_NO				
				, EMP_NO
				, DEPT_NO
				, SCHDUL_SE_CD
				, SCHDUL_SJ
				, SCHDUL_BEGIN_DATE
				, SCHDUL_END_DATE
				, SCHDUL_LOC
				, SCHDUL_CN		
		FROM 
				SCHEDULE 
		WHERE 
				SCHDUL_SE_CD='1' 
		AND 
				EMP_NO=#{empNo}
    </select>
    
    <!-- 팀 일정 불러오기 -->
    <select id="getTeamSchedules" parameterType="String" resultType="scheduleVO">
    	SELECT 
				  SCHDUL_NO
				, EMP_NO
				, DEPT_NO
				, SCHDUL_SE_CD
				, SCHDUL_SJ
				, SCHDUL_BEGIN_DATE
				, SCHDUL_END_DATE
				, SCHDUL_LOC
				, SCHDUL_CN		
		FROM 
				SCHEDULE 
		WHERE 
				(SCHDUL_SE_CD='1' AND DEPT_NO=(SELECT DEPT_NO FROM EMPLOYEE WHERE EMP_NO=#{empNo}) AND EMP_NO != #{empNo}) 
		OR 
				(SCHDUL_SE_CD='2' AND DEPT_NO=(SELECT DEPT_NO FROM EMPLOYEE WHERE EMP_NO=#{empNo}))
    </select>
    <!-- 본부 일정 불러오기 -->
    <select id="getDeptSchedules" parameterType="String" resultType="scheduleVO">
    	SELECT 
				  SCHDUL_NO
				, EMP_NO
				, DEPT_NO
				, SCHDUL_SE_CD
				, SCHDUL_SJ
				, SCHDUL_BEGIN_DATE
				, SCHDUL_END_DATE
				, SCHDUL_LOC
				, SCHDUL_CN		
		FROM 
				SCHEDULE 
		WHERE 
				SCHDUL_SE_CD='3' AND DEPT_NO=(SELECT SUBSTR(DEPT_NO,1,6) FROM EMPLOYEE WHERE EMP_NO=#{empNo})
    </select>
    
    <!-- 회사 일정 불러오기 -->
    <select id="getCompSchedules" resultType="scheduleVO">
    	SELECT 
				  SCHDUL_NO
				, EMP_NO
				, DEPT_NO
				, SCHDUL_SE_CD
				, SCHDUL_SJ
				, SCHDUL_BEGIN_DATE
				, SCHDUL_END_DATE
				, SCHDUL_LOC
				, SCHDUL_CN		
		FROM 
				SCHEDULE 
		WHERE 
				SCHDUL_SE_CD='4'
    </select>
    
    <!-- 특정 일정 불러오기 -->
    <select id="getSchedule" resultType="scheduleVO">
    	SELECT 
				  SCHDUL_NO
				, EMP_NO
				, DEPT_NO
				, SCHDUL_SE_CD
				, SCHDUL_SJ
				, SCHDUL_BEGIN_DATE
				, SCHDUL_END_DATE
				, SCHDUL_LOC
				, SCHDUL_CN		
		FROM 
				SCHEDULE 
		WHERE 
				SCHDUL_NO=#{schdulNo}
    </select>
    
    <!-- 일정 생성 -->
    <insert id="createSchedule" parameterType="scheduleVO">
    	INSERT INTO SCHEDULE
    						(
   							  SCHDUL_NO
   							, EMP_NO
   							, DEPT_NO
   							, SCHDUL_SE_CD
   							, SCHDUL_BEGIN_DATE
   							, SCHDUL_END_DATE
   							, SCHDUL_SJ
			   				<if test="schdulCn!=null and schdulCn!=''">
							, SCHDUL_CN
							</if>
							<if test="schdulLoc!=null and schdulLoc!=''">
							, SCHDUL_LOC
							</if>
							)
		VALUES 
							(
							  SEQ_SCHEDULE.NEXTVAL
							, #{empNo}
							, (SELECT DEPT_NO FROM EMPLOYEE WHERE EMP_NO=#{empNo})
							, #{schdulSeCd}
							, TO_DATE(#{schdulBeginDate},'YYYY-MM-DD HH24:MI:SS')
							, TO_DATE(#{schdulEndDate},'YYYY-MM-DD HH24:MI:SS')
							, #{schdulSj}
							<if test="schdulCn!=null and schdulCn!=''">
							, #{schdulCn}
							</if>
							<if test="schdulLoc!=null and schdulLoc!=''">
							, #{schdulLoc}
							</if>	
							)
    </insert>
    
    <!-- 일정 수정 -->
    <update id="updateSchedule" parameterType="scheduleVO">
    	UPDATE SCHEDULE SET 
   							  EMP_NO = #{empNo}
   							, DEPT_NO = (SELECT DEPT_NO FROM EMPLOYEE WHERE EMP_NO=#{empNo})
   							, SCHDUL_SE_CD = #{schdulSeCd}
   							, SCHDUL_BEGIN_DATE = TO_DATE(#{schdulBeginDate},'YYYY-MM-DD HH24:MI:SS')
   							, SCHDUL_END_DATE = TO_DATE(#{schdulEndDate},'YYYY-MM-DD HH24:MI:SS')
   							, SCHDUL_SJ = #{schdulSj}
			   				<if test="schdulCn!=null and schdulCn!=''">
							, SCHDUL_CN = #{schdulCn}
							</if>
							<if test="schdulLoc!=null and schdulLoc!=''">
							, SCHDUL_LOC = #{schdulLoc}
							</if>
							WHERE SCHDUL_NO = #{schdulNo}	
    </update>
    
    <!-- 일정 삭제 -->
    <delete id="deleteSchedule" parameterType="String">
    	DELETE 
    			FROM SCHEDULE 
    	WHERE 
    			SCHDUL_NO=#{schdulNo}
    </delete>
    
    <!-- 회원 정보 불러오기 -->
    <select id="getEmpInfo" parameterType="String" resultType="empVO">
    	SELECT 
    			E.EMP_NM
    			, E.PROFL_IMAGE_URL
    			, D.DEPT_NM
    			, C.CMMN_CD_NM AS POSITION
    			, R.RSPNSBL_CTGRY_NM
    	FROM EMPLOYEE E
    	JOIN DEPARTMENT D ON E.DEPT_NO = D.DEPT_NO
   		JOIN COMMON_CODE C ON E.POSITION_CD = C.CMMN_CD
    	JOIN RESPONSIBILITY_CATEGORY R ON E.RSPNSBL_CD = R.RSPNSBL_CD
    	WHERE 
    			E.EMP_NO = #{empNo}
    	AND 
    			C.CMMN_CD_GROUP = 'EMP002'
    </select>
</mapper>
