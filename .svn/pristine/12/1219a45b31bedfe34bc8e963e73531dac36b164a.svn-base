<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
			$(() => {
				
				

				
				function getList() {
					const sugestBrdNo = "${suggestDetail.sugestBrdNo}";
					let data = {
						"sugestBrdNo": sugestBrdNo
					};
					$.ajax({
						url: "/suggestion/list/reply",
						data: JSON.stringify(data),
						contentType: "application/json;charset=utf-8",
						type: "post",
						beforeSend: function (xhr) {
							xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
						},
						success: function (res) {
							console.log("result :", res);

							let str = "";

							res.forEach(function (item) {
							
								str += "<li>";
								str += "<div class='user-wrap'>";
								str += "<span class='user-thumb'>";
								str += "<img src='/img/icon/avatar.png' alt='예시이미지'>";
								str += "</span>";
								str += "<div class='user-info'>";
								str += "<div>";
								str += "<div style='display:none;' class='sgtReplyNo' >"+item.sugestBrdReNo +"</div>"
								str += "<span class='user-name'>"+ item.empNm + "</span>";
								str += "<span class='user-position'>"+item.cmmnCdNm+"</span>";
								str += "</div>";
								str += "<div>";
								str += "<span class='user-team'>"+item.deptNm+"</span>";
								str += "<span class='user-date'>"+item.writngDate+"</span>";
								str += "</div>";
								str += "</div>";
								str += "<div class='user-btn'>";
								str += "<button type='button' class='add-btn'>";
								str += "<i class='xi-pen'>";
								str += "</i>";
								str += "</button>";
								str += "<button type='button' id='deleteReply' class='del-btn' data-reply-no='"+item.sugestBrdReNo+"'>";
								str += "<i class='xi-trash'>";
								str += "</i>";
								str += "</button>";
								str += "</div>";
								str += "</div>";
								str += "<div class='txt'>"+item.reSj+"</div>";
								str += "</li>";
								str += "<div>";
								str += "<button type ='button' class='reply-btn'>답글</button> ";
								str += "</div>";
								str += "<br>";

								$("#suggestReplyList").html(str);


							});

						},

					});

				};
				getList();

				// 댓글 삭제
				$(document).on("click","#deleteReply",function(){
					let sugestBrdReNo = $(this).data("replyNo");
					console.log(sugestBrdReNo);
					let data ={
							"sugestBrdReNo":sugestBrdReNo
					}
					
					$.ajax({
						url: "/suggestion/list/reply/delete",
						data: JSON.stringify(data),
						contentType: "application/json;charset=utf-8",
						type: "post",
						dataType:"json",
						beforeSend: function (xhr) {
							xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
						},
						success: function(res){
							console.log(res);
							location.reload();
						}
						
					});
					
					
				});
				
				
				
				
				//댓글 등록
				$("#Replycheck").on("click", function () {
					let reply = $("#suggestReplyInsert").val();
					let empNm = "Test NickName";
					let writngDate = "11111";
					const sugestBrdNo = "${suggestDetail.sugestBrdNo}";

					let data = {
						"sugestBrdNo": sugestBrdNo,
						"reSj": reply

					};
					$.ajax({
						url: "/suggestion/list/reply/insert",
						data: JSON.stringify(data),
						contentType: "application/json;charset=utf-8",
						type: "post",
						dataType:"json",
						beforeSend: function (xhr) {
							xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
						},
						success: function (res) {
							console.log("result :", res);
							let str="";
							
							str += "<li>";
							str += "<div class='user-wrap'>";
							str += "<span class='user-thumb'>";
							str += "<img src='/img/icon/avatar.png' alt='예시이미지'>";
							str += "</span>";
							str += "<div class='user-info'>";
							str += "<div>";
							str += "<span class='user-name'>"+ res.empNm + "</span>";
							str += "<span class='user-position'>"+res.cmmnCdNm+"</span>";
							str += "</div>";
							str += "<div>";
							str += "<span class='user-team'>"+res.deptNm+"</span>";
							str += "<span class='user-date'>"+res.writngDate+"</span>";
							str += "</div>";
							str += "</div>";
							str += "<div class='user-btn'>";
							str += "<button type='button' id='updateReply' class='add-btn'>";
							str += "<i class='xi-pen'>";
							str += "</i>";
							str += "</button>";
							str += "<button type='button' id='deleteReply' class='del-btn'>";
							str += "<i class='xi-trash'>";
							str += "</i>";
							str += "</button>";
							str += "</div>";
							str += "</div>";
							str += "<div class='txt'>"+ res.reSj +"</div>";
							str += "</li>";
							str += "<div>";
							str += "<button type ='button' class='reply-btn'>답글</button> ";
							str += "</div>";
							str += "<br>";

							$("#suggestReplyList").append(str);
							
							$("#suggestReplyInsert").val("");
						}
					});
				});

				
				
				
				
				

				// 건의 게시글 삭제 sweet alert2
				$("#suggestDelete").on("click", function () {
					Swal.fire({
						title: "게시글을 삭제 하시겠습니까?",
						text: "삭제 후 게시글 복원이 불가합니다.",
						icon: "warning",
						showCancelButton: true,
						confirmButtonColor: "#3085d6",
						cancelButtonColor: "#d33",
						confirmButtonText: "Yes"
					}).then((result) => {
						if (result.isConfirmed) {
							const sugestBrdNo = "${suggestDetail.sugestBrdNo}";
							let data ={
								"sugestBrdNo": sugestBrdNo
							};
							$.ajax({
								url: "/suggestion/list/delete",
								data: JSON.stringify(data),
								contentType: "application/json;charset=utf-8",
								type: "post",
								beforeSend: function (xhr) {
									xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
								},
								success:function(res){

									console.log(res);
									//setTimeout(function(){
										Swal.fire({
										title: "삭제 되었습니다!",
										text: "게시글이 삭제되었습니다.",
										icon: "success"
									});
									//},2000);
									
									
									setTimeout(function(){
										location.href='http://localhost/suggestion/list/';
									},1000);
								}
							});

							
						}
					});
				});
			});



		</script>


<!DOCTYPE html>
<html lang="en">

<body>
	<canvas id="gradient"></canvas>

	<div class="main-container">

		<div class="content-wrap">
			<main class="custom">
				<div class="wf-main-container">
					<!-- =============== body 시작 =============== -->
					<!-- =============== 상단타이틀영역 시작 =============== -->
					<div class="wf-tit-wrap">
						<h1 class="page-tit">건의게시판</h1>
						<div class="wf-util">
							<button type="button" class="btn4" id="suggestUpdate">수정</button>
							<button type="button" class="btn3" id="suggestDelete">삭제</button>
							<button type="button" class="btn5"
								onclick="location.href='http://localhost/suggestion/list/'">목록</button>
								
						</div>
					</div>
					<!-- =============== 상단타이틀영역 끝 =============== -->
					<!-- =============== 컨텐츠 영역 시작 =============== -->
					<div class="wf-content-wrap">

						<div class="wf-content-area">

							<!-- wf-insert-form2에 "detail"추가해주세요 -->
							<ul class="wf-insert-form3 detail">
								<li>
									<div class="detail-tit">
										<p class="tit">${suggestDetail.sugestBrdSj }</p>
									</div>
								</li>
								<li>
									<div class="form3-head-wrap">
										<div class="user-info">
											<span class="user-thumb"> <img
												src="/img/icon/avatar.png" alt="예시이미지">
											</span>
											<div>
												<span class="user-name">${suggestDetail.empNm }</span>
											</div>
										</div>
										<p class="date">${suggestDetail.writngDate }</p>
										<p>조회수 ${suggestDetail.rdcnt }</p>
									</div>
								</li>
								<li>
									<p class="detail-content">${suggestDetail.sugestBrdCn }</p>
								</li>
							</ul>

							<!-- 댓글, 코멘트 영역 시작 -->
							<div class="comment-area">
								<ul>
									<div id="suggestReplyList"></div>

								</ul>

								<div id="deleteModal"></div>



								<div class="input-wrap">
									<span class="user-thumb"> <img
										src="/img/icon/avatar.png" alt="예시이미지">
									</span> <input type="text" placeholder="댓글을 입력하세요"
										id="suggestReplyInsert">
									<button class="btn4" id="Replycheck">등록</button>
								</div>
							</div>
							<!-- 댓글, 코멘트 영역 끝 -->

						</div>

					</div>
					<!-- =============== 컨텐츠 영역 끝 =============== -->
					<!-- =============== body 끝 =============== -->
				</div>
			</main>
		</div>
	</div>
</body>

</html>