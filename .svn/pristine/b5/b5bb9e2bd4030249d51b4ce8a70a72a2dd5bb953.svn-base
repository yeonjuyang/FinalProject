<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.workforest.chat.mapper.ChattingMapper">
	
	<select id="getChatRoom" parameterType="hashMap" resultType="chatRoomEmployeeVO">
		SELECT CE.CHAT_ROOM_NO, CR.CHAT_ROOM_NM, CE.EMP_NO
		FROM  CHATROOM_EMPLOYEE CE, CHAT_ROOM CR
		WHERE CE.CHAT_ROOM_NO = CR.CHAT_ROOM_NO
		AND CE.EMP_NO = #{empNo}	
	</select>
	
	<select id="getChat" parameterType="hashMap" resultType="messageVO">
		SELECT M.CHAT_ROOM_NO, M.MSSAGE_NO, M.EMP_NO, M.MSSAGE_CN, M.ATCHMNFL_NO, M.MSSAGE_DATE, E.EMP_NM
		FROM MESSAGE M, EMPLOYEE E
		WHERE CHAT_ROOM_NO = #{chatRoomNo}
		AND M.EMP_NO = E.EMP_NO
		ORDER BY M.MSSAGE_DATE ASC
	</select>
	
	<insert id="addChat" parameterType="hashMap">
		INSERT INTO MESSAGE(MSSAGE_NO, CHAT_ROOM_NO, EMP_NO, MSSAGE_CN, ATCHMNFL_NO, MSSAGE_DATE)
		VALUES(MSG_SEQ.NEXTVAL,#{chatRoomNo},#{empNo},#{content},null,sysdate)
	</insert>
	
	<select id="getEmp" parameterType="hashMap" resultType="empVO">
		SELECT EMP_NO, EMP_NM
		FROM EMPLOYEE
		WHERE EMP_NO = #{empNo}
	</select>
	
	<select id="getChatRoomLastChat" parameterType="hashMap" resultType="messageVO">
		SELECT MSSAGE_NO, CHAT_ROOM_NO, EMP_NO, ATCHMNFL_NO, MSSAGE_CN, MSSAGE_DATE
		FROM MESSAGE 
		WHERE MSSAGE_DATE = (SELECT MAX(MSSAGE_DATE) FROM MESSAGE WHERE CHAT_ROOM_NO = #{chatRoomNo})
		AND CHAT_ROOM_NO = #{chatRoomNo}
	</select>
	
	<select id="getEmpList" parameterType="hashMap" resultType="empVO">
		SELECT E.EMP_NO, E.DEPT_NO, E.EMP_NM, E.POSITION_CD, D.DEPT_NM,C.CMMN_CD_NM AS POSITION
		FROM EMPLOYEE E,COMMON_CODE C, DEPARTMENT D
		WHERE (E.EMP_NO LIKE '%${param}%' OR E.EMP_NM LIKE '%${param}%')
		AND E.DEPT_NO = D.DEPT_NO
		AND E.POSITION_CD = C.CMMN_CD
		AND C.CMMN_CD_GROUP = 'EMP002'
	</select>
	
</mapper>