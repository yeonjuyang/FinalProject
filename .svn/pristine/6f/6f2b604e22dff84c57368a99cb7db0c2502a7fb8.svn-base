<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<style>
.wf-main-container{
	width: 100%;
}
.wf-chat-left{
	height: 100%;
	min-height: auto;
	width: 35%;
}
.wf-chat-body{
	height: 100%;
	min-height: auto;
	width: 100%;
}
.wf-mail-right{
	height: 100%;
	min-height: auto;
	width: 65%;
}
.wf-mail-wrap{
	height: 100%;
	width: 100%;
}
.wf-content-area{
	height: 100%;
}
.chat-content{
	height: 80%;
	overflow: scroll;
}
.comment-area{
	padding: 10px 0px 10px;
}
.wf-chat-body .comment-area{
	padding: 10px 0px 10px;
}
#modal-test{
	width: 200px;
    height: 150px;
    background-color: #ffffff;
    border: 1px solid #ccc;
    position: fixed;
    bottom: 10px;
    right: 10px;
    z-index: 1000;
}
</style>
<script>
let realSize = window.innerWidth;
let realHeight = window.innerHeight;
<%-- let empNo = <%=session.getAttribute("empNo")%> --%>
let empNm = "";
let chatRoomNo = "0";
let empNo = ${empNo} + "";
let chatAddOrInvite = "";	// ëª¨ë‹¬ì°½ íƒ€ê²Ÿì´ ê¸°ì¡´ ì±„íŒ…ë°©ì— ì´ˆëŒ€ì¸ì§€ ìƒˆë¡œìš´ ì±„íŒ…ë°© ìƒì„±ì¸ì§€ êµ¬ë¶„
let chatRoomEmpList = [];
let chatRoomEmpListTemp = []; // ì¼ë‹¨ ì„ì‹œì €ì¥í•´ë’€ë‹¤ê°€ í•„ìš”í• ë•Œ chatRoomEmpListë¡œ ë®ì–´ì”Œìš°ê¸°ìš©ë„

// í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ ê°€ì ¸ì˜¤ê¸°
let currentDate = new Date();

// ì›”ê³¼ ì¼ì´ í•œ ìë¦¬ ìˆ«ìì¸ ê²½ìš° ì•ì— 0ì„ ì¶”ê°€í•˜ì—¬ ë‘ ìë¦¬ë¡œ í‘œì‹œ
let month = ('0' + (currentDate.getMonth() + 1)).slice(-2);
let day = ('0' + currentDate.getDate()).slice(-2);

// ì‹œê°„ì´ í•œ ìë¦¬ ìˆ«ìì¸ ê²½ìš° ì•ì— 0ì„ ì¶”ê°€í•˜ì—¬ ë‘ ìë¦¬ë¡œ í‘œì‹œ
let hours = ('0' + currentDate.getHours()).slice(-2);
let minutes = ('0' + currentDate.getMinutes()).slice(-2);

// yyyy-MM-dd hh:mm í˜•ì‹ìœ¼ë¡œ ë‚ ì§œì™€ ì‹œê°„ì„ í‘œì‹œ
let formattedDateTime = currentDate.getFullYear() + '-' + month + '-' + day + ' ' + hours + ':' + minutes;

$("body").css("width",realSize)
window.addEventListener("resize", function() {
	realSize = window.innerWidth;
	realHeight = window.innerHeight;
	$("body").css("width",realSize)
	$("body").css("height",realHeight)
})

$("header").html("")
$("header").css("height","0px")
$("aside").html("")
$("aside").css("width","0px")

$.ajax({
	url:"/chat/getEmp",
	data:{"empNo":empNo},
	type:"get",
	success:function(res){
		empNm = res.empNm
	}
})





$(function(){
	
	getChatRoomList()
	
	// ë‚´ ì±„íŒ…ë°© ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
	function getChatRoomList(){
		$.ajax({
			url:"/chat/getChatRoom",
			data:{"empNo":empNo},
			type:"get",
			success:function(res){
				let str = "";
				str += `<div class="wf-chat-list">
						    <span class="txt">
					        <i class="xi-wechat"></i>
					        ALL MESSAGE
					    </span>`
				$.each(res,function(i,v){
					connect(v.chatRoomNo)
					str += `<div class="wf-chat-box myChatRoom" idx="\${v.chatRoomNo}">
								<div class="chat-img">
					            	<img src="/resources/img/icon/avatar.png">
						        </div>
						        <div class="chat-txt">
						            <p class="chat-name list-chat-name">\${v.chatRoomNm}</p>
						            <p class="chat-txt"></p>
						        </div>
						        <div class="chat-side">
						            <p class="chat-date"></p>
						            <span class="fw-alarm-badge" style="display:none">&nbsp;</span>
						        </div>
					        </div>`
				})
				
				str += `</div>`
				
				$(".wf-chat-list").html(str)
				$.each(res,function(i,v){
					// ë§ˆì§€ë§‰ ì±„íŒ… ë¶ˆëŸ¬ì˜¤ê¸°
					$.ajax({
						url:"/chat/getChatRoomLastChat",
						data:{"chatRoomNo":v.chatRoomNo},
						type:"get",
						success:function(res){
							if(res.mssageCn){
								$(`.myChatRoom[idx=\${v.chatRoomNo}] .chat-date`).html(res.formatDate.split("_")[1])
								if(res.mssageCn.length > 8){
									$(`.myChatRoom[idx=\${v.chatRoomNo}] p[class=chat-txt]`).html(res.mssageCn.substr(0,8) + "...");
								}else{
									$(`.myChatRoom[idx=\${v.chatRoomNo}] p[class=chat-txt]`).html(res.mssageCn);
								}
							}
						}
					})
					
					// ì•ˆë³¸ ë©”ì„¸ì§€ ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸°
					$.ajax({
						url:"/chat/getOverMsgCount",
						data:{
							"chatRoomNo":v.chatRoomNo,
							"empNo":empNo
						},
						type:"get",
						success:function(res){
								$(`.myChatRoom[idx=\${v.chatRoomNo}] .fw-alarm-badge`).css("display","block");
							if(res == 0){
								$(`.myChatRoom[idx=\${v.chatRoomNo}] .fw-alarm-badge`).css("background","#53a336");
								$(`.myChatRoom[idx=\${v.chatRoomNo}] .fw-alarm-badge`).html("");
							}else{
								$(`.myChatRoom[idx=\${v.chatRoomNo}] .fw-alarm-badge`).html(res);
							}
							
							if(v.chatRoomNo == chatRoomNo){
								$(`.myChatRoom[idx=\${v.chatRoomNo}] .fw-alarm-badge`).css("background","#53a336");
								$(`.myChatRoom[idx=\${v.chatRoomNo}] .fw-alarm-badge`).html("");
							}
							
						}
					})
					
					if(v.chatRoomNo == chatRoomNo){
						$.ajax({
							url:"/chat/modChatEmpDate",
							data:JSON.stringify({
								"chatRoomNo":chatRoomNo,
								"empNo":empNo,
							}),
							type:"put",
							contentType:"application/json",
							success:function(res){
								$(`.myChatRoom[idx=\${chatRoomNo}] .fw-alarm-badge`).css("background","#53a336");
								$(`.myChatRoom[idx=\${chatRoomNo}] .fw-alarm-badge`).html("");
							}
						})
					}
					
					
				})
				
				
				
				
			}
		})
	}
	

	
function getChat(){
	$.ajax({
		url:"/chat/getChat",
		data:{"chatRoomNo":chatRoomNo},
		type:"get",
		success:function(res){
			let str = "";
			$.each(res,function(i,v){
				if(v.mssageCn.substr(-7,7) == "ì ‘ì†í–ˆìŠµë‹ˆë‹¤." || v.mssageCn.substr(-7,7) == "ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤."){
					str += `<div style="text-align:center">\${v.mssageCn.substr(0,v.mssageCn.length)}</div>`;
					return;
				}
				
				if(v.empNo == empNo){
					str += `<div class="user mine">
							    <div class="chat-user-info">
							        <div class="chat-img">
							            <img src="/resources/img/icon/avatar.png">
							        </div>
							        <p class="chat-name emp-chat-name">\${v.empNm}</p>
							        <p class="chat-date">\${v.formatDate}</p>
							    </div>
							    <div class="chat-txt">
							        \${v.mssageCn}
							    </div>
							</div>`
				}else{
					str += `<div class="user you">
					    <div class="chat-user-info">
					        <div class="chat-img">
					            <img src="/resources/img/icon/avatar.png">
					        </div>
					        <p class="chat-name emp-chat-name">\${v.empNm}</p>
					        <p class="chat-date">\${v.formatDate}</p>
					    </div>
					    <div class="chat-txt">
					        \${v.mssageCn}
					    </div>
					</div>`
				}
				
			})
			
			c_chatWin.innerHTML = str;
			
			c_chatWin.scrollTop = c_chatWin.scrollHeight;
			
		}
	})
}
	// ì±„íŒ…ë°© ë¦¬ìŠ¤íŠ¸ í´ë¦­ ì‹œì˜ ê¸°ëŠ¥
	$(document).on("click",".myChatRoom",function(){
		c_chatWin.innerHTML = "";
		chatRoomNo = $(this).attr("idx")
		let chatName = $(".list-chat-name", this).html();
		
		// ì±„íŒ…ìœ„ìª½ ì´ë¦„ ë³€ê²½
		$(".chatRoom-chat-name").html(chatName);
		// ì±„íŒ…ë°© í¸ì§‘ ëª¨ë‹¬ ì´ë¦„
		$("#modal-chat-modify .modal-tit").html(chatName)
		
		// ì±„íŒ…ë°© ë¦¬ìŠ¤íŠ¸ í´ë¦­ì‹œ ì˜†ì— ì±„íŒ…ë°© í™”ë©´ ë„ìš°ê¸°
		getChat();
		
		$.ajax({
			url:"/chat/modChatEmpDate",
			data:JSON.stringify({
				"chatRoomNo":chatRoomNo,
				"empNo":empNo,
			}),
			type:"put",
			contentType:"application/json",
			success:function(res){
				$(`.myChatRoom[idx=\${chatRoomNo}] .fw-alarm-badge`).css("background","#53a336");
				$(`.myChatRoom[idx=\${chatRoomNo}] .fw-alarm-badge`).html("");
			}
		})
		
		
		$.ajax({
			url:"/chat/getChatRoomEmp",
			data:{"chatRoomNo":chatRoomNo},
			type:"get",
			success:function(res){
				let str = "";
				
				chatRoomEmpListTemp = []
				$.each(res,function(i,v){
					chatRoomEmpListTemp.push(v.empNo)
					str += `<div class="chat-one">
                        <div class="img-wrap">
                        	<img src="/resources/img/icon/\${v.proflImageUrl}">
                        </div>
                        <p class="data eNm">\${v.empNm}</p>
                        <p class="data dNm">\${v.deptNm}</p>
                    </div>`;
				})
				
				
				$("#modal-chat-modify .wf-grid-box").html(str)
			}
			
		})
		
		
		
	})	
	
	// ëª¨ë‹¬ ë„ìš¸ ë•Œ ë‚´ìš© ì´ˆê¸°í™”
	// ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°
	$("button[modal-id=modal-new-chat]").on("click",function(){
		chatRoomEmpList = [];
		chatRoomEmpList.push(empNo)
		chatAddOrInvite = "1";
		$("#cc").val("");
		$(".no-data-box").css("display","block")
		$("#modal-new-chat .wf-grid-box").html("");
		
	})
	
	$("#getEmpList").on("click",function(){
		let param = $("#cc").val()
		$.ajax({
			url:"/chat/getEmpList",
			data:{"param":param},
			type:"get",
			success:function(res){
				if(res != ""){
					$(".no-data-box").css("display","none")
					let str = "";
					console.log("chatRoomEmpList:",chatRoomEmpList)
					$.each(res,function(i,v){
						// ì´ˆëŒ€ì¼ ê²½ìš° ì´ë¯¸ ì±„íŒ…ë°©ì— ìˆëŠ” ì‚¬ì›ì´ë©´ ì•ˆë‚˜ì˜¤ê²Œí•¨
						if(chatRoomEmpList.includes(v.empNo)){
							return;
						}
						console.log("v.empNo:",v.empNo)
						str += `<div class="chat-one">
									<span class="checkbox-radio-custom" style="width:10%;">
			                            <input type="checkbox" name="chck\${i}" id="chck\${i}" class="chck" value="\${v.empNo}">
			                            <label for="chck\${i}"> </label>
		                        	</span>
		                            <div class="img-wrap">
		                            	<img src="/resources/img/icon/avatar.png">
			                        </div>
			                        <p class="data eNm">\${v.empNm}</p>
			                        <p class="data dNm">\${v.deptNm}</p>
			                    </div>`
					})
					$("#modal-new-chat .wf-grid-box").html(str);
				}else{
					
				}
				
			}
			
		})
		
	})
	
	// ì›ë˜ êµ¬ìƒì—ì„œëŠ” ìƒˆë¡œìš´ ì±„íŒ…ìƒì„±ë§Œì´ì—ˆëŠ”ë° ì±„íŒ…ë°©ì— ì‚¬ì›ì´ˆëŒ€ë„ ê°™ì€ ëª¨ë‹¬ì„ ì‚¬ìš©í•˜ê²Œ ë¨
	$("#insert-new-chatRoom").on("click",function(){
		let newEmpNoList = []
		let newEmpNmList = []
		// í˜•ì‹ì„ ë§ì¶°ì£¼ê¸° ìœ„í•´ ë§Œë“¬... ë°›ëŠ” íŒŒë¼ë¯¸í„° Map<String,String[]>
		let chatRoomNoList = []
		
		if(chatAddOrInvite == "1"){	// ìƒˆë¡œìš´ ì±„íŒ…ë°©
			newEmpNmList.push(empNm);
			newEmpNoList.push(empNo);
			chatRoomNoList.push("");
		}else{	// ê¸°ì¡´ ì±„íŒ…ë°©ì— ì‚¬ì› ì´ˆëŒ€
			chatRoomNoList.push(chatRoomNo);
		}
		
		$.each($(".chck:checked"),function(i,v){
			let empNm = $(v).parents(".chat-one").find(".eNm").text()
			newEmpNoList.push($(v).val())
			newEmpNmList.push(empNm)
		})
		
		$.ajax({
			url:"/chat/addNewChatRoom",
			data:JSON.stringify({
				"chatRoomNoList":chatRoomNoList,
				"newEmpNoList":newEmpNoList,
				"newEmpNmList":newEmpNmList
			}),
			type:"post",
			contentType:"application/json",
			success:function(res){
				// ì±„íŒ…ë°© ìƒì„±ì‹œ ì±„íŒ…ë°© ë²ˆí˜¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì§„ ì±„íŒ…ë°© ë²ˆí˜¸ë¡œ ì§€ì •
				chatRoomNo = res
				
				getChat();
				getChatRoomList();
				$("#modal-new-chat").removeClass("open")
				
				// ì†Œì¼“ì—ì„œ ì²˜ë¦¬í•˜ë ¤ë‹ˆ í•´ë‹¹ ì†Œì¼“ì— ì ‘ì†í•œ ì‚¬ëŒ ìˆ˜ë§Œí¼ ì¸ì„œíŠ¸ë¼ì„œ ì—¬ê¸°ì—...
				let msg = ":% :% :%" + newEmpNmList + "ë‹˜ì´ ì ‘ì†í–ˆìŠµë‹ˆë‹¤.:%" + chatRoomNo
				console.log("content:",msg.split(":%")[4])
			 	$.ajax({
	            	url:"/chat/addChat",
	            	data:{
	            		"chatRoomNo":chatRoomNo,
	            		"empNo":myId,
	            		"content":msg.split(":%")[3]
	            	},
	            	type:"post",
	            	async:false,
	            	success:function(res){
	            		$(`.myChatRoom[idx=\${chatRoomNo}] .chat-date`).html(formattedDateTime.split(" ")[1])
	            		if(msg.length > 8){
	                		$(`.myChatRoom[idx=\${chatRoomNo}] p[class=chat-txt]`).html(msg.substr(0,8)+"...")
	            		}else{
	                		$(`.myChatRoom[idx=\${chatRoomNo}] p[class=chat-txt]`).html(msg)
	            		}
	            	}
	            })
				
				
				$.each(sockets,function(i,socket) {
					if(socket.chatRoomNo == chatRoomNo){
						socket.send(msg)
					}
				})
				
			}
			
		})
		
		
	})
	
	$(".inviteBtn").on("click",function(){
		chatAddOrInvite = "2";
		chatRoomEmpList = chatRoomEmpListTemp;
		$("#modal-chat-modify").removeClass("open")
		$("#modal-new-chat").addClass("open")
		
	})
	
	
	$("#modal-chat-modify .modifyBtn").on("click",function(){
		let newChatRoomNm = $("#modal-chat-modify #cc").val();
		
		$.ajax({
			url:"/chat/modChatRoomNm",
			data:JSON.stringify({
				"newChatRoomNm":newChatRoomNm,
				"chatRoomNo":chatRoomNo
			}),
			type:"put",
			contentType:"application/json",
			success:function(res){
				getChatRoomList();
				$("#modal-chat-modify").removeClass("open");
			}
			
		})
		
		
	})
	
	$(".chatExit").on("click",function(){
		
		let exitConfirm = confirm("ì±„íŒ…ë°©ì—ì„œ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")
		if(exitConfirm == 1){
			
			$.ajax({
				url:"/chat/deleteChatRoom",
				data:JSON.stringify({
					"chatRoomNo":chatRoomNo,
					"empNo":empNo
				}),
				type:"delete",
				contentType:"application/json",
				success:function(res){
					getChatRoomList();
					$(".chat-content").html("")
					$(".chatRoom-chat-name").html("-- --")
					let msg = ":% :% :%" + empNm + "ë‹˜ì´ ì ‘ì†ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.:%" + chatRoomNo
					
					$.ajax({
		            	url:"/chat/addChat",
		            	data:{
		            		"chatRoomNo":chatRoomNo,
		            		"empNo":myId,
		            		"content":msg.split(":%")[3]
		            	},
		            	type:"post",
		            	async:false,
		            	success:function(res){
		            		$(`.myChatRoom[idx=\${chatRoomNo}] .chat-date`).html(formattedDateTime.split(" ")[1])
		            		if(msg.length > 8){
		                		$(`.myChatRoom[idx=\${chatRoomNo}] p[class=chat-txt]`).html(msg.substr(0,8)+"...")
		            		}else{
		                		$(`.myChatRoom[idx=\${chatRoomNo}] p[class=chat-txt]`).html(msg)
		            		}
		            	}
		            })
					$.each(sockets,function(i,socket) {
						if(socket.chatRoomNo == chatRoomNo){
							socket.send(msg);
						}
					})
					
					chatRoomNo = "0";
					
				}
			})
			
			
		}
		
		
		
		
	})

	$("#chat-input").keypress(function(event){
		if(event.which === 13) {
			send(chatRoomNo);
		} 
	});

let myId = "";
let sockets = [];
let webSocket; // í˜ì´ì§€ ë°”ë€Œë©´ ë³€ìˆ˜ê°€ ì‚¬ë¼ì§„ë‹¤ëŠ” ì‚¬ì‹¤ì— ì£¼ëª©í•  í•„ìš”ê°€ ìˆìŒ
connect("0")

myId = empNo//f_ranID();
const c_chatWin = document.querySelector(".chat-content");
const c_message = document.querySelector("#chat-input");		
const c_send = document.querySelector(".chat-send");
const c_exit = document.querySelector(".xi-log-out");


// ì±„íŒ… ë³´ë‚´ê¸°
c_send.addEventListener("click", function(){
	send(chatRoomNo);
});

// ì—°ê²° ëŠê¸°
c_exit.addEventListener("click", function () {
	disconnect();
}); 
	

//ì—°ê²°
function connect(chatRoomNo) {
	
	let exists = sockets.some(function(socket) {
        return socket.chatRoomNo == chatRoomNo;
    });

    if (exists) {
        return; // ì´ë¯¸ ì¡´ì¬í•˜ë©´ í•¨ìˆ˜ ì¢…ë£Œ
    }
	webSocket = new WebSocket("ws://192.168.146.64:80/ws-chat?chatRoomNo="+chatRoomNo); // End Point
	webSocket.chatRoomNo = chatRoomNo;
	webSocket.onopen = function(event){
		fOpen(chatRoomNo,webSocket)
	};
	
	webSocket.onmessage = fMessage;
	sockets.push(webSocket);
	
}
	
	
	

//ì—°ê²° ì‹œ
function fOpen(chatRoomNo, socket) {
	console.log("open")
}

function send(chatRoomNo) {  // ì›¹ì†Œì¼“ ë©”ì„¸ì§€ ì „ì†¡
	let msg = c_message.value;



	$.each(sockets,function(i,socket) {
		// ì›¹ì†Œì¼“ì¤‘ì—ì„œ í˜„ì¬ ì±„íŒ…ë°©ì—ë§Œ ë³´ëƒ„
        if (socket.chatRoomNo == chatRoomNo) {
        	// ë³´ë‚´ëŠ” ë°ì´í„° êµ¬ë¶„
            socket.send(myId + ":%" + empNm + ":%" + formattedDateTime + ":%" + msg + ":%" + chatRoomNo);
            
            // dbì— ì±„íŒ…ë‚´ìš© insert
            $.ajax({
            	url:"/chat/addChat",
            	data:{
            		"chatRoomNo":chatRoomNo,
            		"empNo":myId,
            		"content":msg
            	},
            	type:"post",
            	async:false,
            	success:function(res){
            		$(`.myChatRoom[idx=\${chatRoomNo}] .chat-date`).html(formattedDateTime.split(" ")[1])
            		if(msg.length > 8){
                		$(`.myChatRoom[idx=\${chatRoomNo}] p[class=chat-txt]`).html(msg.substr(0,8)+"...")
            		}else{
                		$(`.myChatRoom[idx=\${chatRoomNo}] p[class=chat-txt]`).html(msg)
            		}
            	}
            })
        }
    });
    c_message.value = "";
}

function fMessage() {
	let data = event.data;
	// ì‚¬ì›ë²ˆí˜¸
	let data1 = data.split(":%")[0]
	// ì‚¬ì›ì´ë¦„
	let data2 = data.split(":%")[1]
	// í˜„ì¬ ë‚ ì§œ
	let data3 = data.split(":%")[2]
	// ë©”ì„¸ì§€
	let data4 = data.split(":%")[3]
	// ì±„íŒ…ë°©ë²ˆí˜¸
	let data5 = data.split(":%")[4]
	
	// ì±„íŒ…ë£¸ì´ í˜„ì¬ ìì‹ ì´ ë³´ê³ ìˆëŠ” ì±„íŒ…ë£¸ì—ë§Œ ë°ì´í„° ì ìš©
	if(event.currentTarget.chatRoomNo == chatRoomNo){
	console.log("data4:",data4)
	console.log("data5:",data5)
		if(chatRoomNo == data5){
			if(data4.substr(-7,7) == "ì ‘ì†í–ˆìŠµë‹ˆë‹¤." || data4.substr(-7,7) == "ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.") {
			    c_chatWin.innerHTML += `<div style="text-align:center">\${data4.substr(0,data4.length-1)}</div>`;
			    
			}else if(data1 == myId){
				c_chatWin.innerHTML += `<div class="user mine">
						    <div class="chat-user-info">
						        <div class="chat-img">
						            <img src="/resources/img/icon/avatar.png">
						        </div>
						        <p class="chat-name">\${data2}</p>
						        <p class="chat-date">\${data3}</p>
						    </div>
						    <div class="chat-txt">
						        \${data4}
						    </div>
						</div>`
			}else{
				c_chatWin.innerHTML += `<div class="user you">
				    <div class="chat-user-info">
				        <div class="chat-img">
				            <img src="/resources/img/icon/avatar.png">
				        </div>
				        <p class="chat-name">\${data2}</p>
				        <p class="chat-date">\${data3}</p>
				    </div>
				    <div class="chat-txt">
				        \${data4}
				    </div>
				</div>`
			}
			c_chatWin.scrollTop = c_chatWin.scrollHeight;
			
		}
		getChatRoomList();
		
	}
	
	
	
}


function disconnect(chatRoomNo) { // ì›¹ì†Œì¼“ ì¢…ë£Œ
	$.each(sockets,function(i,socket){
		if(socket.chatRoomNo == chatRoomNo){
			socket.send(myId + "ë‹˜ì´ ì ‘ì†ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.%");
			socket.close();
		}
		
	})
	
}
})
</script>

	<!-- =============== body ì‹œì‘ =============== -->
	<!-- =============== ìƒë‹¨íƒ€ì´í‹€ì˜ì—­ ì‹œì‘ =============== -->
	<!-- <div class="wf-tit-wrap">
	    <h1 class="page-tit">
	        <i class="xi-mail"></i>
	        ì „ì²´ë©”ì¼
	        <span class="txt-style1 mg-l">1/51</span>
	    </h1>
	    <div class="side-util">
	        <button type="button" class="btn3">ì‚­ì œ</button>
	    </div>
	</div> -->
	<!-- =============== ìƒë‹¨íƒ€ì´í‹€ì˜ì—­ ë =============== -->
	<!-- =============== ì»¨í…ì¸  ì˜ì—­ ì‹œì‘ =============== -->
	
	<div class="wf-mail-wrap">
	    <div class="wf-content-area wf-chat-left">
	        <button type="button" class="btn5 mail-btn" modal-id="modal-new-chat">ì±„íŒ…ë°© ìƒì„±</button>
	
	        <!-- ì±„íŒ… ëª©ë¡ ì‹œì‘ -->
	<div class="wf-chat-list">
	    <span class="txt">
	        <i class="xi-wechat"></i>
	        ALL MESSAGE
	    </span>
	
	    <!-- ì±„íŒ…ë°©ì´ ì¡´ì¬í•˜ì§€ ì•Šì„ë•Œ -->
	<!-- <div class="no-chat">
	    ì±„íŒ…ë°©ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì±„íŒ…ë°©ì„ ìƒì„±í•´ë³´ì„¸ìš”!
	</div> -->
	
	<!-- ì±„íŒ… ëª©ë¡ -->
	    <!-- <div class="wf-chat-box">
	        <div class="chat-img">
	            <img src="/img/icon/avatar.png">
	        </div>
	        <div class="chat-txt">
	            <p class="chat-name">ì±„íŒ…ë°© ì´ë¦„</p>
	            <p class="chat-txt">ë¯¼ì¤€ì•„ ì–´ë””ë‹ˆ? ğŸ˜Š</p>
	        </div>
	        <div class="chat-side">
	            <p class="chat-date">14:00</p>
	            <span class="fw-alarm-badge">2</span>
	        </div>
	    </div>
	
	
	    <div class="wf-chat-box">
	        <div class="chat-img">
	            <img src="/img/icon/avatar.png">
	        </div>
	        <div class="chat-txt">
	            <p class="chat-name">ì´ì†Œë§, í™©ì§€ì›, ì‹ ì„±ìš°</p>
	            <p class="chat-txt">ì‚¬ì—…ê³„íšì„œ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
	        </div>
	        <div class="chat-side">
	            <p class="chat-date">05:00</p>
	            <span class="fw-alarm-badge">5</span>
	        </div>
	    </div> -->
	
	</div>
	<!-- ì±„íŒ… ëª©ë¡ ë-->
	</div>
	
	<div class="wf-mail-right" style="width: 600px;">
	    <div class="wf-content-area">
	        <!-- ì±„íŒ…ë°© ì‹œì‘-->
	<div class="wf-chat-body">
	    <!-- ì±„íŒ…ë°© ìƒë‹¨ (í†¡ëª…) -->
	<div class="chat-top">
	    <div class="chat-name chatRoom-chat-name">-- --</div>
	    <span class="chat-status-active">ì ‘ì†ì¤‘</span>
	    <!-- <span class="chat-status-inactive">ë¯¸ì ‘ì†ì¤‘</span> -->
	    <div class="chat-util">
	        <button type="button" modal-id="modal-chat-modify">
	            <i class="xi-pen"></i>
	        </button>
	        <button type="button">
	            <i class="xi-info"></i>
	        </button>
	        <button type="button" class="chatExit">
	            <i class="xi-log-out"></i>
	        </button>
	    </div>
	</div>
	<!-- chat-content -->
	<div class="chat-content">
	</div>
	
	<!-- ì±„íŒ… ì…ë ¥ì°½ -->
	    <div class="comment-area">
	        <div class="input-wrap">
	            <span class="user-thumb">
	                <img src="/resources/img/icon/avatar.png" alt="ì˜ˆì‹œì´ë¯¸ì§€">
	            </span>
	            <input type="text" id="chat-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”">
	            <button type="button" class="btn5"><i class="xi-attachment"></i></button>
	            <button class="btn4 chat-send">ë³´ë‚´ê¸°</button>
	        </div>
	    </div>
	</div>
	<!-- ì±„íŒ…ë°© ë-->
	        </div>
	    </div>
	</div>
<!-- =============== ì»¨í…ì¸  ì˜ì—­ ë =============== -->
<!-- =============== body ë =============== -->
<div class="modal" id="modal-new-chat">
    <div class="modal-cont">
        <h1 class="modal-tit">ëŒ€í™”ìƒëŒ€ ì„ íƒ</h1>
        <div class="modal-content-area">
            <ul class="wf-insert-form2 vertical">
                <li>
                    <label for="cc">ì§ì› ê²€ìƒ‰</label>
                    <div>
                        <div class="wf-flex-box">
                            <input type="text" id="cc" placeholder="ì§ì›ì„ ê²€ìƒ‰í•˜ì„¸ìš”">
                            <button type="button" id="getEmpList" class="btn4">
                                <i class="xi-search"></i>
                            </button>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="wf-chat-detail-list">
                        <span class="txt">ëŒ€í™”ìƒëŒ€</span>
                        <div class="no-data-box">ì„ íƒëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                        <div class="wf-grid-box">
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <div class="modal-btn-wrap">
            <button id="insert-new-chatRoom" class="btn2">í™•ì¸</button>
        </div>

        <button class="close-btn"></button>
    </div>
</div>

<div class="modal" id="modal-chat-modify">
    <div class="modal-cont">
        <h1 class="modal-tit">ìµœí”„ ë‹¨í†¡(ì—¬ê¸°ì— í†¡ë°© ì´ë¦„ì´ ë‚˜ì˜¤ê²Œ)</h1>
        <div class="modal-content-area">
            <ul class="wf-insert-form2 vertical">
                <li>
                    <label for="cc">ì´ë¦„ ë³€ê²½</label>
                    <div>
                        <input type="text" id="cc" placeholder="í†¡ë°© ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                    </div>
                </li>
                <li>
                    <div class="wf-chat-detail-list">
                    	<div class="wf-flex-box">
	                        <span class="txt" style="width: 80%;">ëŒ€í™”ìƒëŒ€</span>
	                        <button type="button" class="btn2 inviteBtn">ì¶”ê°€í•˜ê¸°</button>
                        </div>
                        <div class="wf-grid-box">
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <div class="modal-btn-wrap">
            <button class="btn2 modifyBtn">í™•ì¸</button>
        </div>

        <button class="close-btn"></button>
    </div>
</div>

