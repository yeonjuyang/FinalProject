<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team1.workforest.mail.mapper.EmailMapper">
    <sql id="currentPageList">
	    WITH T AS (
	    SELECT
	        ROWNUM RNUM,
	        E.SENDER_EMPL_NO,
	        EM.EMP_NM,
	        E.EMAIL_SJ,
	        E.SEND_DATE,
	        ER.CNFIRM_DATE,
	        E.ATCHMNFL_NO,
	        EM.EMAIL AS SENDER_EMAIL
	    FROM
	        EMAIL E
	    JOIN
	        EMAIL_RECIPIENT ER ON E.EMAIL_NO = ER.EMAIL_NO
	    JOIN
	        EMPLOYEE EM ON E.SENDER_EMPL_NO = EM.EMP_NO
	    WHERE
	        ER.EMP_NO = #{empNo}
		)
		SELECT * FROM T
		WHERE T.RNUM BETWEEN (#{currentPage} * 10) - (10 - 1) AND (#{currentPage} * 10)
		ORDER BY RNUM
    </sql>
    
    <sql id="list">
        SELECT 
            E.SENDER_EMPL_NO,
            E.EMAIL_SJ,
            E.SEND_DATE,
            ER.CNFIRM_DATE,
            E.ATCHMNFL_NO,
            EM.EMP_NM,
            EM.EMAIL AS SENDER_EMAIL
        FROM 
            EMAIL E
        JOIN 
            EMAIL_RECIPIENT ER ON E.EMAIL_NO = ER.EMAIL_NO
        JOIN 
            EMPLOYEE EM ON E.SENDER_EMPL_NO = EM.EMP_NO
        WHERE 
            ER.EMP_NO = #{empNo}
    </sql>

	<select id="getMailList" parameterType="hashMap" resultType="emailVO">
		<include refid="list" />
	</select>
	
	<select id="getTotal" parameterType="hashMap" resultType="int">
		SELECT COUNT(*)
		FROM(
		<include refid="list" />
		)
	</select>
</mapper>