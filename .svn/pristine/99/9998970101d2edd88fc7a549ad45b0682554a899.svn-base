<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!-- Javascript -->
<script src="${pageContext.request.contextPath}/resources/script/common/commonForSchAndRsv.js" defer></script>
<script>
    $(function () {
        adminGetCarResves(1, "", "");

        // 예약 현황 탭 클릭하면 차량 예약 목록 불러오기
        $("#carRsvBtn").on("click", function () {
            adminGetCarResves(1, "", "");
        });

        // 반납 관리 탭 클릭하면 반납 처리 해야되는 예약 목록 불러오기
        $("#rturnWaitBtn").on("click", function () {
            adminGetWaitReturnCarResves(1, "", "");
        });

        // 지난 예약 탭 클릭하면 지난 차량 예약 목록 불러오기
        $("#pastCarRsvBtn").on("click", function () {
            adminGetPastCarResves(1, "", "");
        });
    });

    // 차량 예약 목록 불러오기
    function adminGetCarResves(currentPage, searchOption, keyword) {
        let data = {
            currentPage: currentPage,
            searchOption: searchOption,
            keyword: keyword,
        };
        $.ajax({
            url: "/admin/reservations/car",
            type: "GET",
            data: data,
            dataType: "json",
            success: function (rsvs) {
                console.log("rsvs : ", rsvs);
                $("#carRsvBody").empty();
                if (!rsvs.content.length) {
                    let rowStr = `<tr>
                                    <td colspan="8">
                                        <p>저장된 차량 예약이 없습니다.</p>
                                    </td>
                                </tr>`;
                    $("#carRsvBody").append(rowStr);
                } else {
                    $.each(rsvs.content, function (index, rsv) {
                        let rowStr = "";
                        // 팀원 정보 불러와서 채우기
                        getEmpInfo(rsv.empNo, function (empInfo) {
                            let deptNm = empInfo.deptNm;
                            let empNm = empInfo.empNm;
                            let position = empInfo.position;
                            let rspnsblCtgryNm = empInfo.rspnsblCtgryNm;
                            if (rspnsblCtgryNm != "팀원") {
                                position = rspnsblCtgryNm;
                            }

                            let rturnCd = rsv.rturnCd;
                            console.log("rturnCd", rturnCd);
                            let rturnStr = "";
                            if (rturnCd == "1") {
                                rturnStr = "<span class='wf-badge5'>반납 전</span>";
                            } else if (rturnCd == "2") {
                                rturnStr = "<span class='wf-badge4'>반납 처리 중</span>";
                            } else {
                                rturnStr = "<span class='wf-badge3'>반납 완료</span>";
                            }

                            rowStr += ` <tr>
                                            <td>
                                                <p>\${rsv.rnum}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.carNm}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.carNo}</p>
                                            </td>
                                            <td>
                                                <p>\${empNm} \${position}(\${deptNm})</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.resveBeginDate.substr(0,16)}-\${rsv.resveEndDate.substr(0,16)}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.resveCn}</p>
                                            </td>
                                            <td>
                                            <p>\${rturnStr}</p>
                                            </td>
                                            <td>
                                                <p>
                                                    <button type="button" class="btn4 listDelBtn" data-id="\${rsv.carResveNo}">예약 취소</button>
                                                    <button type="button" class="btn3 listDelBtn" data-id="\${rsv.carResveNo}">예약 취소</button>
                                                </p>
                                            </td>
                                        </tr>`;
                        });
                        $("#carRsvBody").append(rowStr);
                        $("#divPaging").html(rsvs.pagingArea);
                    });
                }
            },
        });
    }

    // 반납 처리해야되는 차량 예약 불러오기
    function adminGetWaitReturnCarResves(currentPage, searchOption, keyword) {
        let data = {
            currentPage: currentPage,
            searchOption: searchOption,
            keyword: keyword,
        };
        $.ajax({
            url: "/admin/reservations/car/waitReturn",
            type: "GET",
            data: data,
            dataType: "json",
            success: function (rsvs) {
                console.log("rsvs : ", rsvs);
                $("#rturnCarRsvBody").empty();
                if (!rsvs.content.length) {
                    let rowStr = `<tr>
                                    <td colspan="8">
                                        <p>저장된 차량 예약이 없습니다.</p>
                                    </td>
                                </tr>`;
                    $("#rturnCarRsvBody").append(rowStr);
                } else {
                    $.each(rsvs.content, function (index, rsv) {
                        let rowStr = "";
                        // 팀원 정보 불러와서 채우기
                        getEmpInfo(rsv.empNo, function (empInfo) {
                            let deptNm = empInfo.deptNm;
                            let empNm = empInfo.empNm;
                            let position = empInfo.position;
                            let rspnsblCtgryNm = empInfo.rspnsblCtgryNm;
                            if (rspnsblCtgryNm != "팀원") {
                                position = rspnsblCtgryNm;
                            }

                            let rturnCd = rsv.rturnCd;
                            console.log("rturnCd", rturnCd);
                            let rturnStr = "";
                            if (rturnCd == "1") {
                                rturnStr = "<span class='wf-badge5'>반납 전</span>";
                            } else if (rturnCd == "2") {
                                rturnStr = "<span class='wf-badge4'>반납 처리 중</span>";
                            } else {
                                rturnStr = "<span class='wf-badge3'>반납 완료</span>";
                            }

                            rowStr += ` <tr>
                                            <td>
                                                <p>\${rsv.rnum}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.carNm}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.carNo}</p>
                                            </td>
                                            <td>
                                                <p>\${empNm} \${position}(\${deptNm})</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.resveBeginDate.substr(0,16)}-\${rsv.resveEndDate.substr(0,16)}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.resveCn}</p>
                                            </td>
                                            <td>
                                            <p>\${rturnStr}</p>
                                            </td>
                                            <td>
                                                <p>
                                                    <button type="button" class="btn4 listDelBtn" data-id="\${rsv.carResveNo}">예약 취소</button>
                                                    <button type="button" class="btn3 listDelBtn" data-id="\${rsv.carResveNo}">예약 취소</button>
                                                </p>
                                            </td>
                                        </tr>`;
                        });
                        $("#rturnCarRsvBody").append(rowStr);
                        $("#rturnDivPaging").html(rsvs.pagingArea);
                    });
                }
            },
        });
    }

    // 지난 차량 예약 목록 불러오기
    function adminGetPastCarResves(currentPage, searchOption, keyword) {
        let data = {
            currentPage: currentPage,
            searchOption: searchOption,
            keyword: keyword,
        };
        $.ajax({
            url: "/admin/reservations/car/past",
            type: "GET",
            data: data,
            dataType: "json",
            success: function (rsvs) {
                console.log("rsvs : ", rsvs);
                $("#pastCarRsvBody").empty();
                if (!rsvs.content.length) {
                    let rowStr = `<tr>
                                    <td colspan="8">
                                        <p>저장된 차량 예약이 없습니다.</p>
                                    </td>
                                </tr>`;
                    $("#pastCarRsvBody").append(rowStr);
                } else {
                    $.each(rsvs.content, function (index, rsv) {
                        let rowStr = "";
                        // 팀원 정보 불러와서 채우기
                        getEmpInfo(rsv.empNo, function (empInfo) {
                            let deptNm = empInfo.deptNm;
                            let empNm = empInfo.empNm;
                            let position = empInfo.position;
                            let rspnsblCtgryNm = empInfo.rspnsblCtgryNm;
                            if (rspnsblCtgryNm != "팀원") {
                                position = rspnsblCtgryNm;
                            }

                            let rturnCd = rsv.rturnCd;
                            console.log("rturnCd", rturnCd);
                            let rturnStr = "";
                            if (rturnCd == "1") {
                                rturnStr = "<span class='wf-badge5'>반납 전</span>";
                            } else if (rturnCd == "2") {
                                rturnStr = "<span class='wf-badge4'>반납 처리 중</span>";
                            } else {
                                rturnStr = "<span class='wf-badge3'>반납 완료</span>";
                            }

                            rowStr += ` <tr>
                                            <td>
                                                <p>\${rsv.rnum}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.carNm}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.carNo}</p>
                                            </td>
                                            <td>
                                                <p>\${empNm} \${position}(\${deptNm})</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.resveBeginDate.substr(0,16)}-\${rsv.resveEndDate.substr(0,16)}</p>
                                            </td>
                                            <td>
                                                <p>\${rsv.resveCn}</p>
                                            </td>
                                            <td>
                                            <p>\${rturnStr}</p>
                                            </td>
                                            <td>
                                                <p>
                                                    <button type="button" class="btn4 listDelBtn" data-id="\${rsv.carResveNo}">예약 취소</button>
                                                    <button type="button" class="btn3 listDelBtn" data-id="\${rsv.carResveNo}">예약 취소</button>
                                                </p>
                                            </td>
                                        </tr>`;
                        });
                        $("#pastCarRsvBody").append(rowStr);
                        $("#pastDivPaging").html(rsvs.pagingArea);
                    });
                }
            },
        });
    }
</script>
<!--------------------------------- body 시작 --------------------------------->
<div class="wf-tit-wrap">
    <h1 class="page-tit">차량 예약 관리</h1>
</div>
<div class="wf-content-wrap">
    <div class="tab-type tab-type2">
        <div class="tab-menu">
            <!-- "active"가 추가되면 메뉴가 활성화됩니다. -->
            <button data-tab="tab1" type="button" class="tab-btn active" id="carRsvBtn">예약 현황</button>
            <button data-tab="tab2" type="button" class="tab-btn" id="rturnWaitBtn">반납 대기</button>
            <button data-tab="tab3" type="button" class="tab-btn" id="pastCarRsvBtn">지난 예약</button>
            <div class="tab-indicator"></div>
        </div>

        <!-- tab1  -->
        <div data-tab="tab1" class="tab-content active">
            <div class="tab-board-lst">
                <div class="wf-content-area">
                    <table class="wf-table">
                        <colgroup>
                            <col style="width: 5%" />
                            <col style="width: 10%" />
                            <col style="width: 10%" />
                            <col style="width: 15%" />
                            <col style="width: 20%" />
                            <col style="width: 15%" />
                            <col style="width: 10%" />
                            <col style="width: 15%" />
                        </colgroup>
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>차량명</th>
                                <th>차량번호</th>
                                <th>예약자</th>
                                <th>예약일시</th>
                                <th>사용목적</th>
                                <th>반납상태</th>
                                <th>상태변경</th>
                            </tr>
                        </thead>
                        <tbody id="carRsvBody"></tbody>
                    </table>
                </div>

                <!-- 페이지네이션 시작 -->
                <nav class="wf-pagination-wrap">
                    <div class="row justify-content-center" id="divPaging"></div>
                </nav>
                <!-- 페이지네이션 끝 -->

                <!-- 검색영역 시작 -->
                <div class="wf-search-area">
                    <div class="select-box">
                        <select id="searchOption">
                            <option value="empNm">예약자명</option>
                            <option value="resveCn">사용목적</option>
                        </select>
                    </div>
                    <input type="text" id="keyword" placeholder="검색할 내용을 입력해주세요" />
                    <button type="button" class="btn4" id="searchBtn">
                        <i class="xi-search"></i>
                    </button>
                </div>
                <!-- 검색영역 끝 -->
            </div>
        </div>

        <!-- tab2  -->
        <div data-tab="tab2" class="tab-content">
            <div class="tab-board-lst">
                <div class="wf-content-area">
                    <table class="wf-table">
                        <colgroup>
                            <col style="width: 5%" />
                            <col style="width: 10%" />
                            <col style="width: 10%" />
                            <col style="width: 15%" />
                            <col style="width: 20%" />
                            <col style="width: 20%" />
                            <col style="width: 10%" />
                            <col style="width: 10%" />
                        </colgroup>
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>차량명</th>
                                <th>차량번호</th>
                                <th>예약자</th>
                                <th>예약일시</th>
                                <th>사용목적</th>
                                <th>반납상태</th>
                                <th>상태변경</th>
                            </tr>
                        </thead>
                        <tbody id="rturnCarRsvBody"></tbody>
                    </table>
                </div>

                <!-- 페이지네이션 시작 -->
                <nav class="wf-pagination-wrap">
                    <div class="row justify-content-center" id="rturnDivPaging"></div>
                </nav>
                <!-- 페이지네이션 끝 -->

                <!-- 검색영역 시작 -->
                <div class="wf-search-area">
                    <div class="select-box">
                        <select name="" id="">
                            <option value="empNm">예약자명</option>
                            <option value="resveCn">사용목적</option>
                        </select>
                    </div>
                    <input type="text" placeholder="검색할 내용을 입력해주세요" />
                    <button type="button" class="btn4">
                        <i class="xi-search"></i>
                    </button>
                </div>
                <!-- 검색영역 끝 -->
            </div>
        </div>

        <!-- tab3  -->
        <div data-tab="tab3" class="tab-content">
            <div class="tab-board-lst">
                <div class="wf-content-area">
                    <table class="wf-table">
                        <colgroup>
                            <col style="width: 5%" />
                            <col style="width: 10%" />
                            <col style="width: 10%" />
                            <col style="width: 15%" />
                            <col style="width: 20%" />
                            <col style="width: 20%" />
                            <col style="width: 10%" />
                            <col style="width: 10%" />
                        </colgroup>
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>차량명</th>
                                <th>차량번호</th>
                                <th>예약자</th>
                                <th>예약일시</th>
                                <th>사용목적</th>
                                <th>반납상태</th>
                                <th>상태변경</th>
                            </tr>
                        </thead>
                        <tbody id="pastCarRsvBody"></tbody>
                    </table>
                </div>

                <!-- 페이지네이션 시작 -->
                <nav class="wf-pagination-wrap">
                    <div class="row justify-content-center" id="pastDivPaging"></div>
                </nav>
                <!-- 페이지네이션 끝 -->

                <!-- 검색영역 시작 -->
                <div class="wf-search-area">
                    <div class="select-box">
                        <select name="" id="">
                            <option value="empNm">예약자명</option>
                            <option value="resveCn">사용목적</option>
                        </select>
                    </div>
                    <input type="text" placeholder="검색할 내용을 입력해주세요" />
                    <button type="button" class="btn4">
                        <i class="xi-search"></i>
                    </button>
                </div>
                <!-- 검색영역 끝 -->
            </div>
        </div>
    </div>

    <!--------------------------------- body 끝 --------------------------------->
</div>
