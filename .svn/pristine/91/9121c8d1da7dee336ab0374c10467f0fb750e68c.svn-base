
// ajax 요청 결과 캐싱을 위한 flag 변수
let flag = false;

$(function () {

	getTabData1('tab1');
	getTabData2('tab2');
	getTabData3('tab3');
	getTabData4('tab4');
	// getTabData5('tab5');

	$('.tab-btn').on('click', function () {
		let tab = $(this).data('tab');
		console.log("tab은? -> ", tab);

		switch (tab) {
			case "1":
				if (!flag) {
					getTabData1(tab);
					flag = true;
				}
				break;
			case "2":
				if (!flag) {
					getTabData2(tab);
					flag = true;
				}
				break;
			case "3":
				if (!flag) {
					getTabData3(tab);
					flag = true;
				}
				break;
			case "4":
				if (!flag) {
					getTabData4(tab);
					flag = true;
				}
				break;
			// case "5":
			// 	if (!flag) {
			// 		getTabData5(tab);
			// 		flag = true;
			// 	}
			// 	break;
			default:
				break;
		}

	});

});


function docFormNo(data) {
	switch (data) {
		case '1':
			return "품의서";
		case '2':
			return "출장신청서";
		case '3':
			return "도서구입신청서";
		default:
			break;
	}
}

// 결재 대기
function getTabData1(tab) {

	$.ajax({
		url: "/approval/listView/myList?tab=" + tab,
		type: "GET",
		dataType: "json",
		success: function (result) {

			console.log("결재 대기 -> ", result);

			//let resultEmpNo = result[0].empNo;    // 기안자
			//let sessionEmpNo = $('#empNo').val(); // 접속 ID

			if (Array.isArray(result) && result.length > 0) {
				result.map((e, i) => {

					let docType = docFormNo(e.docFormNo);

					let HTML = `
						<tr data-apv-no='${e.apvNo}'>
							<td>${i + 1}</td>
							<td>${docType}</td>
							<td>${e.apvSj}</td>
							<td>${e.empNm}</td>
							<td>${e.apvPosition}/${e.apvRspnsbl}</td>
							<td>${e.deptNm}</td>
							<td>${e.drftDate}</td>
							<td>${e.apvDate}</td>
						</tr>		
					`;

					$('.tab-content1').find('tbody').append(HTML);
				});

			} else {
				let HTML = noDate();
				$('.tab-content1').find('tbody').append(HTML);
			}

		},
		error: function (xhr, status, error) {
			console.log("에러 발생: ", error);
		}
	});

}

// 결재 완료
function getTabData2(tab) {

	$.ajax({
		url: "/approval/listView/myList?tab=" + tab,
		type: "GET",
		dataType: "json",
		success: function (result) {
			console.log("결재완료 -> ", result);

			// 데이터 있을때
			if (Array.isArray(result) && result.length > 0) {
				result.map((e, i) => {

					let docType = docFormNo(e.docFormNo);

					let HTML = `
						<tr data-apv-no='${e.apvNo}'>
							<td>${i + 1}</td>
							<td>${docType}</td>
							<td>${e.apvSj}</td>
							<td>${e.empNm}</td>
							<td>${e.apvPosition}/${e.apvRspnsbl}</td>
							<td>${e.deptNm}</td>
							<td>${e.drftDate}</td>
							<td>${e.apvDate}</td>
						</tr>		
					`;

					$('.tab-content2').find('tbody').append(HTML);
				});
			}
			// 데이터 없을때
			else {
				let HTML = noDate();
				$('.tab-content2').find('tbody').append(HTML);
			}
		}
	});

}

// 반려
function getTabData3(tab) {

	$.ajax({
		url: "/approval/listView/myList?tab=" + tab,
		type: "GET",
		dataType: "json",
		success: function (result) {
			console.log("반려 -> ", result);

			// 데이터 있을때
			if (Array.isArray(result) && result.length > 0) {
				result.map((e, i) => {

					let docType = docFormNo(e.docFormNo);

					let HTML = `
						<tr data-apv-no='${e.apvNo}'>
							<td>${i + 1}</td>
							<td>${docType}</td>
							<td>${e.apvSj}</td>
							<td>${e.drftDate}</td>
							<td>${e.refuseDate}</td>
						</tr>		
					`;
					$('.tab-content3').find('tbody').append(HTML);
				});
			}
			// 데이터 없을때
			else {
				let HTML = noDate();
				$('.tab-content3').find('tbody').append(HTML);
			}
		}
	});
}

// 회수
function getTabData4(tab) {

	$.ajax({
		url: "/approval/listView/myList?tab=" + tab,
		type: "GET",
		dataType: "json",
		success: function (result) {
			console.log("회수 -> ", result);

			// 데이터 있을때
			if (Array.isArray(result) && result.length > 0) {
				result.map((e, i) => {
					let docType = docFormNo(e.docFormNo);

					let HTML = `
						<tr data-apv-no='${e.apvNo}'>
							<td>${i + 1}</td>
							<td>${docType}</td>
							<td>${e.apvSj}</td>
							<td>${e.drftDate}</td>
							<td>
								<a href="javascript:void(0)" style="padding: 5px 20px;" class="btn7">재기안</a>
								<a href="javascript:void(0)" style="padding: 5px 20px;" class="btn5">삭제</a>
							</td>
						</tr>		
					`;

					$('.tab-content4').find('tbody').append(HTML);
				});
			}
			// 데이터 없을때
			else {
				let HTML = noDate();
				$('.tab-content4').find('tbody').append(HTML);
			}
		}
	});
}

// 임시 저장함
function getTabData5(tab) {

	$.ajax({
		url: "/approval/listView/myList?tab=" + tab,
		type: "GET",
		dataType: "json",
		success: function (result) {
			console.log("임시 저장함 -> ", result);

			// 데이터 있을때
			if (Array.isArray(result) && result.length > 0) {
				result.map((e, i) => {
					let docType = docFormNo(e.docFormNo);

					let HTML = `
						<tr data-apv-no='${e.apvNo}'>
							<td>${i + 1}</td>
							<td></td>
							<td></td>
							<td></td>
							<td>
								<a href="javascript:void(0)" style="padding: 5px 20px;" class="btn7">재기안</a>
								<a href="javascript:void(0)" style="padding: 5px 20px;" class="btn5">삭제</a>
							</td>
						</tr>		
					`;

					$('.tab-content5').find('tbody').append(HTML);
				});
			}
			// 데이터 없을때
			else {
				let HTML = noDate();
				$('.tab-content5').find('tbody').append(HTML);
			}
		}
	});
}

// 데이터 없을 경우
function noDate() {
	return `<tr><td colspan='7' style="text-align: center;">문서가 없습니다.</td></tr>`;
}

// 상세 조회
$(document).on('click', '.wf-table tbody tr', function () {

	let apvNo = $(this).data('apvNo');

	$.ajax({
		url: '/approval/approvalDetailView?apvNo=' + apvNo,
		type: 'get',
		dataType: 'text',
		success: function () {

			location.href =
				"/approval/approvalDetailView?apvNo=" + apvNo;

		}
	});

});

