<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>    
<style>
.yearClassify{
	height:50px;
	
}
.yearClassify1{
	display: flex;
	flex-direction: column;
}
.box1{
	width: 170px;
	height: 120px;
	text-align: center;
	background-image: linear-gradient(to top, rgba(255, 99, 132, 0.7) 0%, rgba(255, 99, 132, 0.7) 30%, var(--glass-bg) 20%, var(--glass-bg) 100%)
}
.box2{
	width: 200px;
	height: 120px;
	text-align: center;
}
.box2 .heading1{
	position: relative;
	top: 10px;
}
.box3{
	width: 700px;
	height: 350px;
	margin-top: 30px;
}
.moreInfo{
	width: 100%;
	position: relative;
	top: 5px;
}
.line2{
	margin-top: 20px;
}
.align-center{
	text-align: center;
}
.chart-container{
	height: 300px;
	margin: 0 auto;
	display: flex;
  	justify-content: center; /* 내부 요소를 가운데 정렬 */
}
.genderBox{
	width: 300px;
	height: 400px;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
$(function(){
	
	
	// 나이 분포 그래프
	let ageData = [];
	let ageLabels = ['21-25','26-30','31-35','36-40','41-45','46-50','50+']
	$.ajax({
		url:"/adminEmp/getAgeGraph",
		data:{"year":"2024"},
		type:"get",
		success:function(res){
			ageData = res
			drawChart("myChart", ageLabels, ageData)
		}
	})
	
	// 평균 나이
	$.ajax({
		url:"/adminEmp/getAvgAge",
		data:{"year":"2024"},
		type:"get",
		success:function(res){
			$(".avgage").html(res)
		}
	})
	
	// 사원 수
	$.ajax({
		url:"/adminEmp/getEmpCount",
		data:{"year":"2024"},
		type:"get",
		success:function(res){
			$(".allEmpCount").html(res)
		}
	})
	
	// 남녀 성비
	$.ajax({
		url:"/adminEmp/getGenderRate",
		data:{"year":"2024"},
		type:"get",
		success:function(res){
			
			let genderLabels = ["Male","Female"];
			let genderData = [];
			
			console.log(res)
			let maleCount = res[0];
			let femaleCount = res[1];
			
			// 소수2번째자리에서 끊어서 100%가 안되는것 때문에 그냥 100에서 한쪽값을 빼는거로...
			let maleRate = parseInt(maleCount/(maleCount+femaleCount) * 10000)/100
			let femaleRate = parseInt(femaleCount/(maleCount+femaleCount) * 10000)/100
			
			genderData = [maleRate, femaleRate]
			
			$(".maleRate").html(maleCount)
			$(".femaleRate").html(femaleCount)
			
			drawDoughnutChart("genderChart", genderLabels, genderData)
			
		}
	})
	
	// 퇴사자 수, 퇴사자 유형별 수
	$.ajax({
		url:"/adminEmp/getRetireCount",
		data:{"year":"2024"},
		type:"get",
		success:function(res){
			let sumCount = res[0] + res[1];
			// 정년퇴직자
			let retire1 = res[0];
			// 그냥퇴직자
			let retire2 = res[1];
			
			$(".retireCount").html(sumCount)
			
		}
	})
	
	function drawChart(chartDiv, chartLabels, chartData){
	
		const ctx = document.getElementById(chartDiv);
		
		new Chart(ctx, {
			type: 'bar',
			data: {
				labels: chartLabels,
				datasets: [{
					label: '사원 수',
					data: chartData,
					borderWidth: 1
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});
	}
	
	function drawDoughnutChart(chartDiv, chartLabels, chartData){
		
		const ctx = document.getElementById(chartDiv);
		
		new Chart(ctx, {
			type: 'doughnut',
			data:{
				labels:chartLabels,
				datasets: [{
					label: chartLabels,
					data: chartData,
					backgroundColor: [
					  'rgb(54, 162, 235)',
					  'rgb(255, 99, 132)',
					],
					hoverOffset: 4
				}]
			},
			options: {
				plugins: {
				    tooltip: {
				        callbacks: {
				            label: function(context) {
				            	let label = context.label || '';

		                        if (label) {
		                            label += ': ';
		                        }
		                        	console.log("context:");
		                        if (context.dataset.data[context.dataIndex] !== null) {
		                            label += context.dataset.data[context.dataIndex] + "%";
		                        }
		                        return label;
				            }
				       }
				   }
				}
			}
		})	
	}
	
  
  
})
</script>
<div class="wf-main-container">
	<div class="wf-tit-wrap">
		<h1 class="page-tit">사원 통계</h1>
	</div>
	<div class="wf-flex-box">
		<div>
			<div class="wf-content-wrap wf-flex-box line1">
			
				<div class="wf-content-area box2">
					<p class="heading1 align-center">사원</p>
					<p class="heading1 align-center">관리/통계</p>
				</div>
				<div class="wf-content-area box1" style="margin-top: 0px;">
					<p class="heading2 align-center">전체 사원 수</p>
					<p class="heading1 align-center allEmpCount">&nbsp;</p>
					<p class="heading2 align-center moreInfo">More Info >></p>
				</div>
				<div class="wf-content-area box1" style="margin-top: 0px;">
					<p class="heading2 align-center">퇴사율</p>
					<p class="heading1 align-center">5</p>
					<p class="heading2 align-center moreInfo">More Info >></p>
				</div>
				<div class="wf-content-area box1" style="margin-top: 0px;">
					<p class="heading2 align-center">평균 나이</p>
					<p class="heading1 align-center avgage">&nbsp;</p>
					<p class="heading2 align-center moreInfo">More Info >></p>
				</div>
				<div class="wf-content-area box1" style="margin-top: 0px;">
					<p class="heading2 align-center">직급 분포도</p>
					<p class="heading1 align-center">그래프</p>
					<p class="heading2 align-center moreInfo">More Info >></p>
				</div>
				<div class="wf-content-area box1" style="margin-top: 0px;">
					<p class="heading2 align-center">연봉 분포도</p>
					<p class="heading1 align-center">그래프</p>
					<p class="heading2 align-center moreInfo">More Info >></p>
				</div>
				
			</div>
			<div class="wf-flex-box line2">
				<div class="yearClassify1" style="height: 190px; overflow: hidden;">
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2024</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2023</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2022</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2021</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2020</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2019</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2018</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2017</p>
					</div>
					<div class="wf-content-area yearClassify" style="margin-top: 10px; width:70px;">
						<p class="heading2 align-center">2016</p>
					</div>
				</div>
				<div class="wf-content-area line2 box" style="margin-top: 0px;">
					<p class="heading2 align-center">고용자 수</p>
					<p class="heading2 align-center moreInfo">More Info >></p>
					<p class="heading2 align-center">누르면 신입사원, <br>경력직사원 숫자 및 정보</p>
				</div>
				<div class="wf-content-area line2">
					<p class="heading2 align-center">퇴사자 수</p>
					<p class="heading2 align-center retireCount">&nbsp;</p>
					<div class="chart-container2">
						<canvas id="retireChart"></canvas>
					</div>
				</div>
				<div class="wf-content-area line2">
					<p class="heading2 align-center">나이 분포도</p>
					<p class="heading2 align-center">그래프</p>
				</div>
				<div class="wf-content-area line2">
					<p class="heading2 align-center">부서별 인원수</p>
				</div>
				
			</div>
		
		</div>
		
		<div class="wf-content-area genderBox" style="margin-top: 0px;">
			<div class="wf-flex-box">
				<div style="margin: 0px auto;">
					<p class="heading2 align-center">이미지 남자</p>
					<p class="heading1 align-center maleRate">&nbsp;</p>
				</div>
				<div style="margin: 0px auto;">
					<p class="heading2 align-center">이미지 여자</p>
					<p class="heading1 align-center femaleRate">&nbsp;</p>
				</div>
			</div>
			<div>
				<canvas id="genderChart"></canvas>
			</div>
		</div>
		
	</div>
	<div class="wf-flex-box line3">
		<div class="wf-content-area box3">
			<p class="heading2 align-center">그래프</p>
			<div class="chart-container">
				<canvas id="myChart"></canvas>
			</div>
		</div>
	</div>
</div>